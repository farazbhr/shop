<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/navigation.css}"/>
    <script>
        const bottles = new Map();
        const crates = new Map();
        let maxItemsPossible = 0;
        window.onload = function () {
            maxItemsPossible = document.getElementById("tableOrders").getElementsByTagName('tr').length;
        }

        function addItem(itemId, map) {
            let numBottles = map.get(itemId);
            if (numBottles == undefined) {
                // empty yet
                numBottles = 1;
            } else {
                numBottles = numBottles + 1;
            }
            map.set(itemId, numBottles);
            document.getElementById(itemId).getElementsByTagName('p')[0].innerHTML = numBottles;
        }

        function removeItem(itemId, map) {
            let numBottles = map.get(itemId);
            if (numBottles == undefined) {
                // do nothing
            } else {
                if (numBottles <= 1) {
                    map.delete(itemId);
                    document.getElementById(itemId).getElementsByTagName('p')[0].innerHTML = "0";
                } else {
                    numBottles = numBottles - 1;
                    map.set(itemId, numBottles);
                    document.getElementById(itemId).getElementsByTagName('p')[0].innerHTML = numBottles;
                }
            }
        }

        function fillForm() {

            // über orderItems iterieren
            var iterator_obj = bottles.entries();
            let entry = iterator_obj.next();
            alert("mapsize   " + bottles.size  + " " + entry + " max "  +maxItemsPossible);
            for (let i = 0; entry != null && entry.value != undefined && maxItemsPossible > 0; i++) {
                alert(entry);
                maxItemsPossible = maxItemsPossible - 1; //size of the list orderItems in controller
                // itr über attr
                for (const elem of document.getElementById("tableOrders").getElementsByTagName('tr')[i].getElementsByTagName("input")) {
                    elem.setAttribute("value",i.toString());
                    alert(elem.outerHTML);
                }
                entry = iterator_obj.next()
            }
            alert("finished");
        }
    </script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>Beverage shop</title>
</head>
<body>


<ul>
    <li><a class="active" href="http://localhost:8080/beverages">Beverages</a></li>
    <li><a href="http://localhost:8080/portfolio">Portfolio</a></li>
    <li><a href="http://localhost:8080/basket">Basket</a></li>
    <li><a href="http://localhost:8080/order">Order</a></li>




    <!--        <table id="tableOrders">       &lt;!&ndash; style="display: none" &ndash;&gt;-->
<!--            <p><span th:text="${#lists.size(shopOrder.orderItems)}"/></p>-->
<!--            <form method="POST"  onsubmit="fillForm()" th:action="@{/addToBasket}"-->
<!--                  th:object="${shopOrder.orderItems}" >-->

<!--                <th:block th:each="shopItem : ${shopOrder.orderItems}">-->
<!--                <tr >-->
<!--                    <td> <input  th:name="beverageId" type="number" th:text="${shopItem.beverageId}" /> </td>-->
<!--                    <td> <input  th:name="id" type="number" th:text="${shopItem.id}" /> </td>-->
<!--                </tr>-->
<!--                </th:block>-->

<!--                    <button>Add to the shop</button>-->

<!--&lt;!&ndash;                    <td><input th:type="submit" id="submitButton" th:value="ToBasket"/></td>&ndash;&gt;-->

<!--            </form>-->
<!--        </table>-->


</ul>


<h1>Single Bottles</h1>
<table class="table">
    <thead>
    <tr>
        <th>Item number</th>
        <th>Name</th>
        <th>Image</th>
        <th>Volume</th>
        <th>Volume Percent</th>
        <th>Is alcoholic</th>
        <th>Price</th>
        <th>Supplier</th>
        <th>In stock</th>
        <th>Add/Remove</th>
    </tr>
    </thead>


    <tr th:each="bottle : ${bottles}">
        <td th:text="${bottle.id}"></td>
        <td th:text="${bottle.name}"></td>
        <td><img height="200" th:src="${bottle.picture}" alt="No picture"/></td>
        <td th:text="${bottle.volume}"></td>
        <td th:text="${bottle.volumePercent}"></td>
        <td th:text="${bottle.isAlcoholic}"></td>
        <td th:text="${bottle.price}"></td>
        <td th:text="${bottle.supplier}"></td>
        <td th:text="${bottle.inStock}"></td>

        <td>
            <form method="POST" th:action="@{/addToBasket}">
                <input type="hidden" th:name="id" th:value="${bottle.id}">
                <input th:name="number" type="text" th:value="0">
                <button>Add to basket</button>
            </form>
        </td>


           <!-- <div th:id="${bottle.id}">
                <button onclick="addItem(this.parentNode.id, bottles)">+</button>
                <p> 0 </p>
                <button onclick="removeItem(this.parentNode.id,bottles)">-</button>
            </div>
            -->


    </tr>
</table>

<h1>Crates</h1>
<table class="table">
    <thead>
    <tr>
        <th>Item number</th>
        <th>Name</th>
        <th>Image</th>
        <th>Bottle</th>
        <th>Number of Bottles</th>
        <th>Price</th>
        <th>In stock</th>
        <th>Add/Remove</th>

    </tr>
    </thead>
    <tr th:each="crate : ${crates}">
        <td th:text="${crate.id}"></td>
        <td th:text="${crate.name}"></td>
        <td><img height="200" th:src="${crate.picture}" alt="No picture"/></td>
        <td th:text="${crate.bottle.name}"></td>
        <td th:text="${crate.noOfBottles}"></td>
        <td th:text="${crate.price}"></td>
        <td th:text="${crate.inStock}"></td>
        <td>
            <div th:id="${crate.id}">
                <button onclick="addItem(this.parentNode.id, crates)">+</button>
                <p> 0 </p>
                <button onclick="removeItem(this.parentNode.id,crates)">-</button>
            </div>
        </td>
    </tr>

</table>

</body>
</html>